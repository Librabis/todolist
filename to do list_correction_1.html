<!DOCTYPE html>
<html>

<head>
    <title>Page Title</title>
    <link rel="stylesheet" href="style.css"> </head>

<body>
   <div id="listTitle"></div>
    <div id="tasksBlock"></div>
    <script>
        let formKeeper = document.getElementById("tasksBlock")
            //inputStringConstructor конструктор строит блок, инпут и кнопку по полученным значениям класса блока, название тэга, css класс задачи, имени кнопки и действия кнопки
        let inputStringConstructor = function (classBlock, tagCreate, classTask, buttonName, buttonDo, taskText, clickButton) {
                let stringBlock = document.createElement("div")
                stringBlock.classList.add(classBlock)
                let inputBlock = document.createElement(tagCreate)
                inputBlock.classList.add(classTask)
                stringBlock.append(inputBlock)
                let changeButton = document.createElement("div")
                changeButton.classList.add("button")
                changeButton.addEventListener("click", buttonDo)
                changeButton.innerText = buttonName
                stringBlock.append(changeButton)
                placeInDocument(classTask, stringBlock, clickButton)
                if (taskText) {
                    switch (tagCreate) {
                    case "div":
                        inputBlock.innerText = taskText
                        break;
                    case "input":
                        inputBlock.value = taskText
                        break;
                    }
                    if (classTask === "inputTask") {
                        let deleteButton = document.createElement("div")
                        deleteButton.classList.add("button")
                        deleteButton.addEventListener("click", deleteTask)
                        deleteButton.innerText = "X";
                        stringBlock.append(deleteButton)
                    }
                }
            }
            //placeInDocument помещение в верстку по переданному значению класса css и созданному блоку
        let placeInDocument = function (classTask, stringBlock, clickButton) {
                switch (classTask) {
                case "add":
                    formKeeper.insertAdjacentElement("afterEnd", stringBlock);
                    break;
                case "title":
                    document.getElementById("listTitle").insertAdjacentElement("afterBegin", stringBlock);
                    break;
                case "inputTask":
                    if (clickButton.previousElementSibling.classList.contains("add")) {
                        formKeeper.insertAdjacentElement("beforeEnd", stringBlock)
                    }
                    else {
                        clickButton.parentElement.insertAdjacentElement("afterEnd", stringBlock)
                    }
                    break;
                }
                //                if (classTask === "add") {
                //                    formKeeper.insertAdjacentElement("afterEnd", stringBlock)
                //                }
                //                else if (classTask === "title") {
                //                    formKeeper.insertAdjacentElement("beforeBegin", stringBlock)
                //                }
                //                else if (classTask === "inputTask") {                   clickButton.insertAdjacentElement("afterEnd", stringBlock)
                //                }
            }
            //listName добавляет название для списка 
            //////////////////////////////////////////////////////////
        let addListName = function (clickButton) {
            let taskText = clickButton.target.previousElementSibling
            inputStringConstructor("block", "div", "title", "correct list name", correctListName, taskText.value, clickButton.target);
            clickButton.target.previousElementSibling.parentElement.remove()
        }
        let correctListName = function (clickButton) {
                let taskText = clickButton.target.previousElementSibling.textContent
            inputStringConstructor("block", "input", "title", "accept list name", addListName, taskText, clickButton.target);
            clickButton.target.previousElementSibling.parentElement.remove()
            }
            //////////////////////////////////////////////////////////
            //addTask добавление нового элемента
        let addTask = function (clickButton) {
                let taskText = clickButton.target.previousElementSibling
                if (taskText.value) {
                    inputStringConstructor("block", "div", "inputTask", "correct", correct, taskText.value, clickButton.target);
                    taskText.value = "";
                    if (!document.getElementById("allTasksList")) {
                        let taskList = document.createElement("div")
                        taskList.classList.add("button")
                        taskList.innerText = "Get list"
                        taskList.addEventListener("click", getList)
                        taskList.id = "allTasksList"
                        taskText.parentElement.insertAdjacentElement("afterEnd", taskList)
                    }
                }
            }
            //correct и agree корректировка и согласие (вытаскивает значение из инпута, заменяет блоком, меняет надпись на кнопке, удаляет изначальный блок или обратно)
        let correct = function (clickButton) {
            let taskText = clickButton.target.previousElementSibling.textContent
            inputStringConstructor("block", "input", "inputTask", "agree", agree, taskText, clickButton.target);
            clickButton.target.previousElementSibling.parentElement.remove()
        }
        let agree = function (clickButton) {
            let taskText = clickButton.target.previousElementSibling
            inputStringConstructor("block", "div", "inputTask", "correct", correct, taskText.value, clickButton.target);
            clickButton.target.previousElementSibling.parentElement.remove()
        }

        function doingF() {
            alert("done")
        }
        //deleteTask удаление (создание кнопки, помещение в верстку, присвоение функции удаления при нажатии)
        let deleteTask = function (clickElement) {
                clickElement.target.parentElement.remove()
            }
            //getList получает значение всех задач и вывоит в алерт
        let getList = function () {
            let allTasks = [];
            for (let i = 0; i < formKeeper.childNodes.length; i++) {
                allTasks[i] = `${i+1}. ${formKeeper.childNodes[i].querySelector(".inputTask").innerHTML} `
                    //formKeeper.childNodes[i].querySelector(".inputTask").innerHTML
                    //
            }
            alert(`For ${document.getElementById("listTitle").firstChild.firstChild.innerText} need to do:
${allTasks}`)
        }
        inputStringConstructor("block", "input", "add", "add", addTask)
        inputStringConstructor("block", "input", "title", "add list name", addListName)
    </script>
</body>

</html>